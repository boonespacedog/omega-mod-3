<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arithmetic Functions Explorer</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #1e3c72;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 18px;
        }
        .function-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .function-btn {
            padding: 12px 24px;
            border: 2px solid #1e3c72;
            background: white;
            color: #1e3c72;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            position: relative;
        }
        .function-btn:hover {
            background: #f0f4f8;
        }
        .function-btn.active {
            background: #1e3c72;
            color: white;
        }
        .tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .function-btn:hover .tooltip {
            opacity: 1;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .control-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        .control-card h3 {
            margin-top: 0;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .slider-container {
            margin: 15px 0;
        }
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
            color: #666;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #1e3c72;
            cursor: pointer;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        .btn-primary {
            background: #1e3c72;
            color: white;
        }
        .btn-primary:hover {
            background: #2a5298;
        }
        .plot-container {
            margin-bottom: 30px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .info-box {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #1e3c72;
        }
        .formula {
            background: white;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            text-align: center;
            border: 1px solid #ddd;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1e3c72;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¢ Arithmetic Functions Explorer</h1>
        <p class="subtitle">Discover biases in fundamental number-theoretic functions</p>
        
        <div class="function-selector">
            <button class="function-btn active" onclick="selectFunction('omega')">
                Œ©(n)
                <span class="tooltip">Total prime factors with multiplicity</span>
            </button>
            <button class="function-btn" onclick="selectFunction('littleOmega')">
                œâ(n)
                <span class="tooltip">Distinct prime factors</span>
            </button>
            <button class="function-btn" onclick="selectFunction('tau')">
                œÑ(n)
                <span class="tooltip">Number of divisors</span>
            </button>
            <button class="function-btn" onclick="selectFunction('sigma')">
                œÉ(n)
                <span class="tooltip">Sum of divisors</span>
            </button>
            <button class="function-btn" onclick="selectFunction('phi')">
                œÜ(n)
                <span class="tooltip">Euler's totient function</span>
            </button>
            <button class="function-btn" onclick="selectFunction('liouville')">
                Œª(n)
                <span class="tooltip">Liouville function</span>
            </button>
        </div>
        
        <div class="info-box" id="functionInfo">
            <h3>Œ©(n) - Prime Omega Function</h3>
            <p>Counts the total number of prime factors of n with multiplicity.</p>
            <div class="formula">Œ©(12) = Œ©(2¬≤ √ó 3) = 2 + 1 = 3</div>
        </div>
        
        <div class="controls">
            <div class="control-card">
                <h3>‚öôÔ∏è Parameters</h3>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Maximum n</span>
                        <span id="maxNValue">10,000</span>
                    </div>
                    <input type="range" id="maxNSlider" min="3" max="6" value="4" step="0.1">
                </div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Modulus</span>
                        <span id="modValue">3</span>
                    </div>
                    <input type="range" id="modSlider" min="2" max="12" value="3" step="1">
                </div>
            </div>
            
            <div class="control-card">
                <h3>üéÆ Controls</h3>
                <button class="btn-primary" onclick="computeDistribution()">Compute Distribution</button>
                <button class="btn-primary" onclick="compareAllFunctions()">Compare All Functions</button>
                <div id="status" class="loading"></div>
            </div>
            
            <div class="control-card">
                <h3>üìä Statistics</h3>
                <div id="statsDisplay" class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value">-</div>
                        <div class="stat-label">Chi-squared</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">-</div>
                        <div class="stat-label">Max deviation</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="plot-container">
            <div id="distributionPlot"></div>
        </div>
        
        <div class="plot-container">
            <div id="comparisonPlot"></div>
        </div>
        
        <div class="plot-container">
            <div id="heatmapPlot"></div>
        </div>
    </div>

    <script>
        let currentFunction = 'omega';
        let currentData = {};
        
        // Function info database
        const functionInfo = {
            omega: {
                name: 'Œ©(n) - Prime Omega Function',
                description: 'Counts the total number of prime factors of n with multiplicity.',
                example: 'Œ©(12) = Œ©(2¬≤ √ó 3) = 2 + 1 = 3',
                compute: omega
            },
            littleOmega: {
                name: 'œâ(n) - Little Omega Function',
                description: 'Counts the number of distinct prime factors of n.',
                example: 'œâ(12) = œâ(2¬≤ √ó 3) = 2 (primes: 2 and 3)',
                compute: littleOmega
            },
            tau: {
                name: 'œÑ(n) - Divisor Function',
                description: 'Counts the number of positive divisors of n.',
                example: 'œÑ(12) = 6 (divisors: 1, 2, 3, 4, 6, 12)',
                compute: tau
            },
            sigma: {
                name: 'œÉ(n) - Sum of Divisors',
                description: 'Sum of all positive divisors of n.',
                example: 'œÉ(12) = 1 + 2 + 3 + 4 + 6 + 12 = 28',
                compute: sigma
            },
            phi: {
                name: 'œÜ(n) - Euler\'s Totient Function',
                description: 'Counts integers up to n that are coprime to n.',
                example: 'œÜ(12) = 4 (coprime: 1, 5, 7, 11)',
                compute: phi
            },
            liouville: {
                name: 'Œª(n) - Liouville Function',
                description: 'Returns (-1)^Œ©(n), related to the M√∂bius function.',
                example: 'Œª(12) = (-1)¬≥ = -1',
                compute: liouville
            }
        };
        
        // Arithmetic functions implementations
        function omega(n) {
            if (n <= 1) return 0;
            let count = 0;
            let temp = n;
            
            while (temp % 2 === 0) {
                count++;
                temp = Math.floor(temp / 2);
            }
            
            for (let i = 3; i * i <= temp; i += 2) {
                while (temp % i === 0) {
                    count++;
                    temp = Math.floor(temp / i);
                }
            }
            
            if (temp > 1) count++;
            return count;
        }
        
        function littleOmega(n) {
            if (n <= 1) return 0;
            let count = 0;
            let temp = n;
            
            if (temp % 2 === 0) {
                count++;
                while (temp % 2 === 0) {
                    temp = Math.floor(temp / 2);
                }
            }
            
            for (let i = 3; i * i <= temp; i += 2) {
                if (temp % i === 0) {
                    count++;
                    while (temp % i === 0) {
                        temp = Math.floor(temp / i);
                    }
                }
            }
            
            if (temp > 1) count++;
            return count;
        }
        
        function tau(n) {
            if (n <= 0) return 0;
            let count = 0;
            for (let i = 1; i * i <= n; i++) {
                if (n % i === 0) {
                    count++;
                    if (i * i !== n) count++;
                }
            }
            return count;
        }
        
        function sigma(n) {
            if (n <= 0) return 0;
            let sum = 0;
            for (let i = 1; i * i <= n; i++) {
                if (n % i === 0) {
                    sum += i;
                    if (i * i !== n) sum += n / i;
                }
            }
            return sum;
        }
        
        function phi(n) {
            if (n <= 0) return 0;
            let result = n;
            
            if (n % 2 === 0) {
                while (n % 2 === 0) n /= 2;
                result -= result / 2;
            }
            
            for (let i = 3; i * i <= n; i += 2) {
                if (n % i === 0) {
                    while (n % i === 0) n /= i;
                    result -= result / i;
                }
            }
            
            if (n > 1) result -= result / n;
            return result;
        }
        
        function liouville(n) {
            return Math.pow(-1, omega(n));
        }
        
        // UI functions
        function selectFunction(funcName) {
            currentFunction = funcName;
            document.querySelectorAll('.function-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update info box
            const info = functionInfo[funcName];
            document.getElementById('functionInfo').innerHTML = `
                <h3>${info.name}</h3>
                <p>${info.description}</p>
                <div class="formula">${info.example}</div>
            `;
            
            // Adjust modulus slider for Liouville function
            if (funcName === 'liouville') {
                document.getElementById('modSlider').max = 4;
                if (parseInt(document.getElementById('modSlider').value) > 4) {
                    document.getElementById('modSlider').value = 2;
                    document.getElementById('modValue').textContent = 2;
                }
            } else {
                document.getElementById('modSlider').max = 12;
            }
        }
        
        // Update slider displays
        document.getElementById('maxNSlider').addEventListener('input', (e) => {
            const value = Math.pow(10, parseFloat(e.target.value));
            document.getElementById('maxNValue').textContent = value.toLocaleString();
        });
        
        document.getElementById('modSlider').addEventListener('input', (e) => {
            document.getElementById('modValue').textContent = e.target.value;
        });
        
        // Main computation
        async function computeDistribution() {
            const maxN = Math.pow(10, parseFloat(document.getElementById('maxNSlider').value));
            const mod = parseInt(document.getElementById('modSlider').value);
            const func = functionInfo[currentFunction].compute;
            
            document.getElementById('status').textContent = 'Computing...';
            
            // For Liouville, adjust modulus handling
            const effectiveMod = (currentFunction === 'liouville' && mod > 2) ? 
                Math.pow(2, mod - 1) : mod;
            
            const checkpoints = [];
            for (let exp = 2; exp <= Math.log10(maxN); exp += 0.2) {
                checkpoints.push(Math.floor(Math.pow(10, exp)));
            }
            if (checkpoints[checkpoints.length - 1] !== maxN) {
                checkpoints.push(maxN);
            }
            
            const results = [];
            
            for (let checkpoint of checkpoints) {
                const counts = new Array(effectiveMod).fill(0);
                
                // Allow UI updates
                await new Promise(resolve => setTimeout(resolve, 0));
                
                for (let n = 1; n <= checkpoint; n++) {
                    const value = func(n);
                    if (currentFunction === 'liouville') {
                        // For Liouville, map -1 to 1, and 1 to 0
                        const index = value === 1 ? 0 : 1;
                        if (mod > 2) {
                            // Extended: look at Œª(n) * powers of 2
                            // This creates more classes
                            counts[0]++; // Placeholder for extended analysis
                        } else {
                            counts[index]++;
                        }
                    } else {
                        counts[((value % effectiveMod) + effectiveMod) % effectiveMod]++;
                    }
                }
                
                const fractions = counts.map(c => c / checkpoint);
                results.push({ n: checkpoint, fractions, counts });
            }
            
            currentData = { function: currentFunction, mod: effectiveMod, results };
            updatePlots();
            updateStatistics(results[results.length - 1]);
            document.getElementById('status').textContent = '';
        }
        
        // Update plots
        function updatePlots() {
            const { results, mod } = currentData;
            const traces = [];
            
            // Create traces for each residue class
            for (let i = 0; i < mod; i++) {
                const label = currentFunction === 'liouville' && mod === 2 ? 
                    (i === 0 ? 'Œª(n) = 1' : 'Œª(n) = -1') : 
                    `${currentFunction}(n) ‚â° ${i} (mod ${mod})`;
                
                traces.push({
                    x: results.map(r => r.n),
                    y: results.map(r => r.fractions[i]),
                    mode: 'lines+markers',
                    name: label,
                    line: { width: 3 },
                    marker: { size: 6 }
                });
            }
            
            // Add expected line
            traces.push({
                x: [results[0].n, results[results.length - 1].n],
                y: [1/mod, 1/mod],
                mode: 'lines',
                name: `Expected (1/${mod})`,
                line: { color: '#333', width: 2, dash: 'dash' }
            });
            
            Plotly.newPlot('distributionPlot', traces, {
                title: `Distribution of ${currentFunction}(n) mod ${mod}`,
                xaxis: { 
                    title: 'n', 
                    type: 'log',
                    tickformat: '.0e',
                    dtick: 1
                },
                yaxis: { 
                    title: 'Fraction',
                    range: [0, Math.max(0.5, 2/mod)]
                },
                hovermode: 'x unified'
            });
        }
        
        // Update statistics
        function updateStatistics(lastResult) {
            const { fractions, counts, n } = lastResult;
            const mod = currentData.mod;
            
            // Calculate chi-squared
            const expected = n / mod;
            let chiSquared = 0;
            let maxDev = 0;
            
            for (let i = 0; i < mod; i++) {
                chiSquared += Math.pow(counts[i] - expected, 2) / expected;
                const dev = Math.abs(fractions[i] - 1/mod);
                maxDev = Math.max(maxDev, dev);
            }
            
            document.getElementById('statsDisplay').innerHTML = `
                <div class="stat-box">
                    <div class="stat-value">${chiSquared.toFixed(0)}</div>
                    <div class="stat-label">Chi-squared</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">${(maxDev * 100).toFixed(2)}%</div>
                    <div class="stat-label">Max deviation</div>
                </div>
            `;
            
            // Add detailed breakdown
            let details = '<div style="margin-top: 20px; font-size: 14px;">';
            for (let i = 0; i < mod; i++) {
                const percent = (fractions[i] * 100).toFixed(2);
                const deviation = ((fractions[i] - 1/mod) * 100).toFixed(2);
                const label = currentFunction === 'liouville' && mod === 2 ? 
                    (i === 0 ? 'Œª = 1' : 'Œª = -1') : 
                    `class ${i}`;
                details += `${label}: ${percent}% (${deviation > 0 ? '+' : ''}${deviation}%)<br>`;
            }
            details += '</div>';
            document.getElementById('statsDisplay').innerHTML += details;
        }
        
        // Compare all functions
        async function compareAllFunctions() {
            const maxN = 10000; // Fixed for comparison
            const mod = parseInt(document.getElementById('modSlider').value);
            
            document.getElementById('status').textContent = 'Comparing all functions...';
            
            const functionNames = Object.keys(functionInfo);
            const maxDeviations = {};
            
            for (let funcName of functionNames) {
                const func = functionInfo[funcName].compute;
                const effectiveMod = (funcName === 'liouville' && mod > 2) ? 2 : mod;
                const counts = new Array(effectiveMod).fill(0);
                
                for (let n = 1; n <= maxN; n++) {
                    const value = func(n);
                    if (funcName === 'liouville') {
                        counts[value === 1 ? 0 : 1]++;
                    } else {
                        counts[((value % effectiveMod) + effectiveMod) % effectiveMod]++;
                    }
                }
                
                const fractions = counts.map(c => c / maxN);
                const maxDev = Math.max(...fractions.map(f => Math.abs(f - 1/effectiveMod)));
                maxDeviations[funcName] = maxDev * 100;
                
                await new Promise(resolve => setTimeout(resolve, 0));
            }
            
            // Create comparison plot
            const trace = {
                x: Object.keys(maxDeviations).map(k => functionInfo[k].name.split(' ')[0]),
                y: Object.values(maxDeviations),
                type: 'bar',
                marker: {
                    color: Object.values(maxDeviations),
                    colorscale: 'Viridis'
                }
            };
            
            Plotly.newPlot('comparisonPlot', [trace], {
                title: `Maximum Deviation from Uniform (n = ${maxN.toLocaleString()}, mod ${mod})`,
                xaxis: { title: 'Function' },
                yaxis: { title: 'Maximum Deviation (%)' }
            });
            
            // Create heatmap for multiple moduli
            await createModulusHeatmap();
            
            document.getElementById('status').textContent = '';
        }
        
        // Create heatmap showing bias across different moduli
        async function createModulusHeatmap() {
            const maxN = 10000;
            const functions = ['omega', 'littleOmega', 'tau', 'sigma', 'phi'];
            const moduli = [2, 3, 4, 5, 6, 7, 8, 9, 10];
            
            const z = [];
            const yLabels = [];
            
            for (let funcName of functions) {
                const func = functionInfo[funcName].compute;
                const row = [];
                
                for (let mod of moduli) {
                    const counts = new Array(mod).fill(0);
                    
                    for (let n = 1; n <= maxN; n++) {
                        const value = func(n);
                        counts[((value % mod) + mod) % mod]++;
                    }
                    
                    const fractions = counts.map(c => c / maxN);
                    const maxDev = Math.max(...fractions.map(f => Math.abs(f - 1/mod)));
                    row.push(maxDev * 100);
                }
                
                z.push(row);
                yLabels.push(functionInfo[funcName].name.split(' ')[0]);
                
                await new Promise(resolve => setTimeout(resolve, 0));
            }
            
            const data = [{
                z: z,
                x: moduli,
                y: yLabels,
                type: 'heatmap',
                colorscale: 'Viridis',
                hovertemplate: '%{y}<br>mod %{x}<br>Max dev: %{z:.2f}%<extra></extra>'
            }];
            
            Plotly.newPlot('heatmapPlot', data, {
                title: 'Bias Intensity Across Functions and Moduli',
                xaxis: { title: 'Modulus', dtick: 1 },
                yaxis: { title: 'Function' }
            });
        }
        
        // Initialize
        window.addEventListener('load', () => {
            Plotly.newPlot('distributionPlot', [], {
                title: 'Select a function and click "Compute Distribution"',
                xaxis: { title: 'n' },
                yaxis: { title: 'Fraction' }
            });
        });
    </script>
</body>
</html>